<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Repair Phone BX - R√©paration iPhone Express √† Bruxelles (1080)</title>
    <meta name="description" content="R√©paration d'√©cran et batterie iPhone en 30 minutes √† Molenbeek (Ribaucourt). Prix imbattables d√®s 40‚Ç¨. Garantie incluse. Sans rendez-vous.">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://repair-phone-bx-1.onrender.com/">
    <meta property="og:title" content="R√©paration iPhone Express - Repair Phone BX">
    <meta property="og:description" content="√âcran cass√© ? Batterie faible ? R√©paration en 30 min devant vous. D√®s 40‚Ç¨.">
    <meta property="og:image" content="https://repair-phone-bx-1.onrender.com/images/iphone-13Pro.jpg">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì±</text></svg>">
    
    <style>
        :root { 
            --primary: #ff5c39; --dark: #1d1d1f; --bg-body: #fbfbfd; 
            --green-gradient: linear-gradient(180deg, #34c759 0%, #30b753 100%);
            --radius-md: 18px; --shadow-sm: 0 2px 8px rgba(0,0,0,0.04); --shadow-hover: 0 20px 40px rgba(0,0,0,0.1);
            --promo: #ff3b30; --eco: #34c759;
        }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; margin: 0; color: var(--dark); background-color: var(--bg-body); scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
        
        header { padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: rgba(255,255,255,0.85); backdrop-filter: blur(20px); z-index: 1000; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo { font-size: 22px; font-weight: 700; color: var(--dark); }
        .btn-contact { background: var(--dark); color: white; padding: 10px 22px; border-radius: 99px; cursor: pointer; border: none; font-weight: 600; }

        .hero { background: linear-gradient(135deg, #ffffff 0%, #fff8f6 100%); padding: 60px 20px; max-width: 1200px; margin: 30px auto; border-radius: 24px; text-align: center; box-shadow: var(--shadow-sm); border: 1px solid rgba(0,0,0,0.03); }
        .promo-banner { background: linear-gradient(90deg, #ff5c39, #ff3b30); color: white; padding: 8px 16px; border-radius: 99px; font-weight: 700; text-transform: uppercase; font-size: 11px; display: inline-block; margin-bottom: 20px; }
        .hero h1 { font-size: 42px; margin: 0 0 10px 0; color: #1d1d1f; }

        /* BARRE DE RECHERCHE */
        .search-container { max-width: 600px; margin: 0 auto 40px auto; position: relative; }
        .search-input { width: 100%; padding: 16px 50px; border: 1px solid #ddd; border-radius: 99px; font-size: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: 0.3s; }
        .search-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 4px 15px rgba(255, 92, 57, 0.15); }
        .search-icon { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 20px; color: #999; }

        .container { display: flex; max-width: 1200px; margin: 0 auto; padding: 0 20px 80px 20px; gap: 40px; }
        
        .sidebar { width: 240px; position: sticky; top: 100px; height: fit-content; background: white; padding: 10px; border-radius: var(--radius-md); display: none; box-shadow: var(--shadow-sm); }
        .sidebar li { list-style: none; padding: 14px 20px; margin-bottom: 5px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; color: #86868b; transition: 0.2s; }
        .sidebar li:hover { background: #f5f5f7; color: var(--dark); }
        @media (min-width: 1024px) { .sidebar { display: block; } }

        .services-list { flex: 1; }
        .category-title { font-size: 24px; font-weight: 700; margin: 50px 0 25px 0; color: var(--dark); display: flex; align-items: center; scroll-margin-top: 120px; }
        .category-title::before { content: ''; display: block; width: 6px; height: 24px; background: var(--primary); border-radius: 4px; margin-right: 12px; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 25px; }

        .card { background: white; border-radius: var(--radius-md); overflow: hidden; transition: 0.3s; border: 1px solid rgba(0,0,0,0.04); display: flex; flex-direction: column; box-shadow: var(--shadow-sm); }
        .card:hover { transform: translateY(-8px); box-shadow: var(--shadow-hover); }

        .card-img-container { height: 240px; background: #f9f9f9; display: flex; align-items: center; justify-content: center; padding: 30px; position: relative; }
        .card-img { max-height: 100%; max-width: 100%; object-fit: contain; mix-blend-mode: multiply; }
        
        .badge { position: absolute; top: 12px; left: 12px; background: rgba(255,255,255,0.9); backdrop-filter: blur(4px); font-size: 10px; font-weight: 700; padding: 6px 12px; border-radius: 99px; text-transform: uppercase; }
        .badge-promo { background: var(--promo); color: white; }
        .badge-eco { background: var(--eco); color: white; }
        .badge-new { background: #0071e3; color: white; }
        
        .card-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 17px; font-weight: 600; margin: 0 0 6px 0; }
        .card-desc { font-size: 13px; color: #86868b; margin-bottom: 15px; line-height: 1.4; flex: 1; }
        
        .toggle-tech { background: none; border: none; color: #0071e3; font-size: 12px; font-weight: 500; cursor: pointer; padding: 0; margin-bottom: 12px; text-align: left; }
        .tech-details { font-size: 11px; color: #555; margin-bottom: 15px; display: none; background: #f5f5f7; padding: 10px; border-radius: 8px; line-height: 1.5; }

        .price-row { display: flex; align-items: baseline; margin-bottom: 15px; }
        .price-old { text-decoration: line-through; color: #bbb; font-size: 14px; margin-right: 10px; font-weight: 500; }
        .price-current { font-size: 24px; font-weight: 700; color: var(--dark); }
        .price-promo { color: var(--promo); }

        .btn-buy { background: var(--green-gradient); color: white; border: none; padding: 14px; width: 100%; border-radius: 12px; font-weight: 600; cursor: pointer; font-size: 14px; transition: 0.2s; box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3); }
        .btn-buy:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(52, 199, 89, 0.4); }

        /* MODAL */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal { background: white; padding: 35px; border-radius: 24px; width: 480px; max-width: 90%; position: relative; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .modal-tech-info { background: #f5f9ff; border: 1px solid rgba(0, 113, 227, 0.1); padding: 15px; border-radius: 12px; font-size: 13px; color: #004085; margin-bottom: 25px; line-height: 1.6; }
        
        .price-recap { background: #fffdf5; padding: 15px; border-radius: 12px; margin-bottom: 25px; border: 1px solid rgba(255, 193, 7, 0.2); }
        .price-row-modal { display:flex; justify-content:space-between; margin-bottom:8px; font-size:14px; color: #555; }

        /* CHOIX PAIEMENT */
        .payment-options { display: flex; gap: 10px; margin-bottom: 20px; }
        .payment-option { flex: 1; border: 2px solid #eee; padding: 15px; border-radius: 12px; cursor: pointer; text-align: center; transition: 0.2s; }
        .payment-option.active { border-color: var(--primary); background: #fff5f2; }
        .payment-option strong { display: block; font-size: 16px; margin-bottom: 4px; }
        .payment-option small { font-size: 12px; color: #666; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { font-weight: 600; font-size: 13px; display: block; margin-bottom: 8px; }
        .form-group input { width: 100%; padding: 14px; border: 1px solid #d2d2d7; border-radius: 12px; font-size: 15px; }
        .phone-group { display: flex; align-items: center; }
        .phone-prefix { background: #f5f5f7; border: 1px solid #d2d2d7; border-right: none; padding: 14px; border-radius: 12px 0 0 12px; font-weight: 600; color: #555; font-size: 15px; }
        #phoneInput { border-radius: 0 12px 12px 0; }
        
        .btn-confirm { background: var(--primary); color: white; border: none; padding: 16px; width: 100%; font-weight: 700; cursor: pointer; border-radius: 14px; font-size: 16px; transition: transform 0.2s; }
        .btn-confirm:hover { transform: scale(1.02); }

        /* AVIS */
        .reviews-section { max-width: 1200px; margin: 60px auto; background: white; padding: 50px; border-radius: var(--radius-md); box-shadow: var(--shadow-md); }
        .review-form input, .review-form textarea, .review-form select { border: 1px solid #d2d2d7; border-radius: 12px; padding: 12px; width: 100%; margin-bottom: 10px; font-family: inherit; }
        .review-item { border-bottom: 1px solid #eee; padding: 20px 0; position: relative; }
        
        /* FIX MOBILE IOS ZOOM */
        @media screen and (max-width: 768px) {
            .container { flex-direction: column; padding: 15px; } 
            .sidebar { display: none; } 
            .modal { width: 90%; padding: 25px; } 
            .grid { grid-template-columns: 1fr; }
            input, select, textarea { font-size: 16px !important; } /* Emp√™che le zoom auto */
        }
    </style>
</head>
<body>

    <header>
        <div class="logo">repairphonebx<span style="color:var(--primary)">.</span></div>
        <button class="btn-contact" id="contactBtn" onclick="showNumber()">Nous contacter</button>
    </header>

    <div class="hero">
        <div class="promo-banner">üî• PROMO FIN NOVEMBRE</div>
        <h1>R√©paration iPhone Express</h1>
        <p style="margin-bottom: 20px;">üìç Ribaucourt, 1080 Molenbeek</p>
        <div style="display:inline-flex; gap:10px; flex-wrap:wrap; justify-content:center;">
            <span style="background:#f0f0f0; padding:5px 12px; border-radius:8px; font-size:13px; font-weight:500;">‚úÖ 30 minutes</span>
            <span style="background:#f0f0f0; padding:5px 12px; border-radius:8px; font-size:13px; font-weight:500;">üíé Pi√®ces Premium</span>
            <span style="background:#f0f0f0; padding:5px 12px; border-radius:8px; font-size:13px; font-weight:500;">üõ°Ô∏è Garantie incluse</span>
        </div>
    </div>

    <div class="search-container">
        <span class="search-icon">üîç</span>
        <input type="text" class="search-input" id="searchInput" placeholder="Rechercher votre mod√®le (ex: iPhone 13)..." onkeyup="filterServices()">
    </div>

    <div class="container">
        <div class="sidebar">
            <ul>
                <li onclick="scrollToSection('eco')">üçè GAMME √âCO (Petits Prix)</li>
                <li onclick="scrollToSection('promo')">üî• PROMO FLASH (50‚Ç¨)</li>
                <li onclick="scrollToSection('normal')">üì± √âCRANS (Max)</li>
                <li onclick="scrollToSection('oled')">üíé GAMME OLED (15/16)</li>
                <li onclick="scrollToSection('batterie')">üîã BATTERIES</li>
                <li onclick="scrollToSection('avis')">‚≠ê AVIS CLIENTS</li>
            </ul>
        </div>

        <div class="services-list">

            <h2 class="category-title" id="eco">GAMME √âCO (Petits Prix)</h2>
            <div id="eco-grid" class="grid">
                <p style="color:#999; padding:20px;">Chargement des produits...</p>
            </div>

            <h2 class="category-title" id="promo">PROMO FLASH 50‚Ç¨</h2>
            <div id="promo-grid" class="grid"></div>

            <h2 class="category-title" id="normal">√âCRANS HORS PROMO</h2>
            <div id="normal-grid" class="grid"></div>

            <h2 class="category-title" id="oled">√âCRANS OLED (NOUVEAUT√âS)</h2>
            <div id="oled-grid" class="grid"></div>

            <h2 class="category-title" id="batterie">BATTERIES NEUVES</h2>
            <div id="battery-grid" class="grid"></div>
        </div>
    </div>

    <div class="reviews-section" id="avis">
        <h3>Avis Clients</h3>
        <div class="review-form">
            <input type="text" id="reviewName" placeholder="Votre nom">
            <select id="reviewRating">
                <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê - Excellent</option>
                <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê - Tr√®s bon</option>
                <option value="3">‚≠ê‚≠ê‚≠ê - Moyen</option>
                <option value="2">‚≠ê‚≠ê - Bof</option>
                <option value="1">‚≠ê - Mauvais</option>
            </select>
            <textarea id="reviewContent" placeholder="Racontez votre exp√©rience..."></textarea>
            <button class="btn-contact" onclick="submitReview()" style="margin-top: 10px; width: 100%;">Publier l'avis</button>
        </div>
        <div id="reviews-display" style="margin-top: 40px;"></div>
    </div>

    <div style="max-width: 1200px; margin: 0 auto; padding: 20px; margin-bottom: 40px;">
        <h2 style="text-align:center; color:var(--dark); margin-bottom:20px;">üìç Nous trouver</h2>
        <div style="width: 100%; height: 400px; border-radius: 24px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);">
            <iframe 
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2518.6351136143165!2d4.338582376946546!3d50.85647537167196!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47c3c3939274a6b3%3A0x40e3c7171247d925!2sRibaucourt!5e0!3m2!1sfr!2sbe!4v1700000000000!5m2!1sfr!2sbe" 
                width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </div>

    <div class="modal-overlay" id="legalModal">
        <div class="modal modal-large">
            <button onclick="document.getElementById('legalModal').style.display='none'" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:24px; cursor:pointer;">√ó</button>
            <h2>Conditions G√©n√©rales de Vente (CGV)</h2>
            <div style="font-size:13px; line-height:1.6; color:#555; text-align: justify;">
                <p><strong>1. √âditeur du service</strong><br>
                Repair Phone BX - Service de r√©paration de t√©l√©phonie mobile.<br>
                Situ√© √† : Ribaucourt, 1080 Molenbeek-Saint-Jean.</p>

                <p><strong>2. Garantie des r√©parations</strong><br>
                Nos r√©parations (√©crans et batteries) sont garanties <strong>6 mois</strong> hors casse, oxydation ou mauvaise utilisation. La garantie couvre uniquement la pi√®ce remplac√©e.</p>

                <p><strong>3. Donn√©es personnelles</strong><br>
                Le client est tenu d'effectuer une sauvegarde de ses donn√©es avant toute intervention. Repair Phone BX ne pourra √™tre tenu responsable en cas de perte de donn√©es.</p>

                <p><strong>4. Paiement & Acompte</strong><br>
                L'acompte de 15‚Ç¨ vers√© en ligne via Stripe permet de r√©server la pi√®ce et le cr√©neau. Le solde est d√ª sur place apr√®s v√©rification du bon fonctionnement de l'appareil. En cas d'annulation moins de 24h avant, l'acompte n'est pas remboursable.</p>

                <p><strong>5. Appareils non r√©clam√©s</strong><br>
                Tout appareil non r√©clam√© dans un d√©lai de 90 jours apr√®s r√©paration sera consid√©r√© comme abandonn√© et pourra √™tre recycl√©.</p>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="bookingModal">
        <div class="modal">
            <button onclick="closeModal()" style="position:absolute; top:20px; right:20px; border:none; background:none; font-size:24px; cursor:pointer;">√ó</button>
            <h2>R√©server</h2>
            
            <div id="techInfoModal" class="modal-tech-info"></div>

            <div class="payment-options">
                <div class="payment-option active" onclick="selectPayment('deposit', this)">
                    <strong>Acompte</strong>
                    <span style="color:var(--primary); font-weight:bold;">15 ‚Ç¨</span>
                    <br><small>Reste √† payer sur place</small>
                </div>
                <div class="payment-option" onclick="selectPayment('full', this)">
                    <strong>Totalit√©</strong>
                    <span id="fullPriceBtn" style="color:var(--primary); font-weight:bold;">0 ‚Ç¨</span>
                    <br><small>Paiement complet</small>
                </div>
            </div>

            <div class="price-recap">
                <div class="price-row-modal"><span>Service :</span><span id="selectedServiceDisplay" style="font-weight:bold"></span></div>
            </div>
            
            <div class="form-group"><label>Nom Complet</label><input type="text" id="nameInput" placeholder="Pr√©nom Nom"></div>
            <div class="form-group"><label>Email (Pour le re√ßu)</label><input type="email" id="emailInput" placeholder="exemple@gmail.com"></div>
            <div class="form-group"><label>T√©l√©phone</label><div class="phone-group"><span class="phone-prefix">+32</span><input type="number" id="phoneInput" placeholder="467 12 34 56"></div></div>
            <div class="form-group"><label>Date</label><input type="date" id="dateInput"></div>
            
            <button class="btn-confirm" onclick="confirmBooking()">Payer l'acompte (15‚Ç¨)</button>
        </div>
    </div>

    <script>
        const API_URL = 'https://repair-phone-bx-1.onrender.com';
        
        let currentPrice = 0;
        let selectedService = "";
        let paymentChoice = 'deposit';

        const techLCD = `<strong>Norme :</strong> √âcran LCD LTPS (Qualit√©/Prix)<br><strong>Solidit√© :</strong> Verre renforc√©.<br><strong>Couleurs :</strong> Gamut P3 vives.<br><strong>R√©activit√© :</strong> Tactile fluide.`;
        const techOLED = `<strong>Technologie :</strong> √âcran COMPATIBLE OLED<br><strong>Qualit√© :</strong> Affichage exceptionnel d'origine.`;

        // GENERATION HTML
        function createCard(item) {
            let badge = "", oldPriceHtml = "", desc = "", tech = "";
            let type = item.category; // ECO, PROMO, NORMAL, OLED, BATTERIE

            if (type === "PROMO") {
                badge = `<div class="badge badge-promo">-50%</div>`;
                oldPriceHtml = `<span class="price-old">${item.old_price}‚Ç¨</span>`;
                desc = "Remplacement √âcran LCD";
                tech = techLCD;
            } else if (type === "ECO") {
                badge = `<div class="badge badge-eco">TOP PRIX</div>`; 
                desc = "Remplacement √âcran LCD";
                tech = techLCD;
            } else if (type === "OLED") {
                badge = `<div class="badge badge-new">NOUVEAU</div>`;
                desc = "Remplacement √âcran OLED Premium";
                tech = techOLED;
            } else if (type === "NORMAL") {
                desc = "Remplacement √âcran LCD Premium";
                tech = techLCD;
            } else {
                badge = `<div class="badge">ORIGINE</div>`;
                desc = "Batterie neuve haute capacit√©";
            }

            let price = item.price;
            let serviceName = type === "BATTERIE" ? `${item.model} - Batterie` : `${item.model} - √âcran`;
            
            return `
            <div class="card">
                <div class="card-img-container">
                    ${badge}
                    <img src="${item.image}" class="card-img" alt="${item.model}" loading="lazy">
                </div>
                <div class="card-body">
                    <div class="card-title">${serviceName}</div>
                    <div class="card-desc">${desc}</div>
                    ${type !== "BATTERIE" ? `<button class="toggle-tech" onclick="toggleTech(this)">Voir d√©tails techniques</button><div class="tech-details">${tech}</div>` : ''}
                    <div class="price-row">
                        ${oldPriceHtml}
                        <span class="price-current ${type === 'PROMO' ? 'price-promo' : ''}">${price} ‚Ç¨</span>
                    </div>
                    <button class="btn-buy" onclick="openBooking('${serviceName}', ${price}, '${type}')">R√âSERVER</button>
                </div>
            </div>`;
        }

        // --- CHARGEMENT DYNAMIQUE DES PRODUITS ---
        async function loadProducts() {
            try {
                const res = await fetch(API_URL + '/api/products');
                const products = await res.json();

                // Filtrer par cat√©gorie
                const eco = products.filter(p => p.category === 'ECO');
                const promo = products.filter(p => p.category === 'PROMO');
                const normal = products.filter(p => p.category === 'NORMAL');
                const oled = products.filter(p => p.category === 'OLED');
                const batt = products.filter(p => p.category === 'BATTERIE');

                document.getElementById('eco-grid').innerHTML = eco.map(createCard).join('');
                document.getElementById('promo-grid').innerHTML = promo.map(createCard).join('');
                document.getElementById('normal-grid').innerHTML = normal.map(createCard).join('');
                document.getElementById('oled-grid').innerHTML = oled.map(createCard).join('');
                document.getElementById('battery-grid').innerHTML = batt.map(createCard).join('');
                
                window.allProductsLoaded = true;
            } catch (e) {
                console.error("Erreur chargement produits", e);
                document.querySelector('.services-list').innerHTML = "<p style='text-align:center; padding:50px; color:red;'>Erreur de chargement des produits. Rechargez la page.</p>";
            }
        }

        // Lancer le chargement au d√©marrage
        loadProducts();

        function filterServices() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.card').forEach(card => {
                card.style.display = card.innerText.toLowerCase().includes(query) ? 'flex' : 'none';
            });
        }

        function toggleTech(btn) { const d = btn.nextElementSibling; d.style.display = d.style.display === 'block' ? 'none' : 'block'; btn.innerText = d.style.display === 'block' ? 'Masquer' : 'Voir caract√©ristiques'; }
        function showNumber() { document.getElementById('contactBtn').innerText = "üìû 0467 79 17 37"; }
        function scrollToSection(id) { document.getElementById(id).scrollIntoView({behavior: 'smooth'}); }

        function openBooking(service, price, type) {
            selectedService = service;
            currentPrice = price;
            
            const techModal = document.getElementById('techInfoModal');
            if (type === "OLED") techModal.innerHTML = `<strong>üíé √âcran OLED :</strong> Qualit√© d'origine, noirs parfaits, contraste infini.`;
            else if (type === "PROMO" || type === "NORMAL" || type === "ECO") techModal.innerHTML = `<strong>üì± √âcran LCD LTPS :</strong> Solidit√© renforc√©e, excellent rapport qualit√©/prix.`;
            else techModal.innerHTML = `<strong>üîã Batterie Neuve :</strong> Haute capacit√©, garantie incluse.`;

            document.getElementById('selectedServiceDisplay').innerText = service;
            document.getElementById('fullPriceBtn').innerText = price + " ‚Ç¨";
            
            paymentChoice = 'deposit';
            document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('active'));
            document.querySelector('.payment-option:first-child').classList.add('active');

            const input = document.getElementById('dateInput');
            const now = new Date();
            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            input.min = now.toISOString().split('T')[0];
            input.max = endOfMonth.toISOString().split('T')[0];
            
            document.getElementById('bookingModal').style.display = 'flex';
        }

        function selectPayment(type, element) {
            paymentChoice = type;
            document.querySelectorAll('.payment-option').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            const btn = document.querySelector('.btn-confirm');
            btn.innerText = type === 'deposit' ? "Payer l'acompte (15‚Ç¨)" : `Payer la totalit√© (${currentPrice}‚Ç¨)`;
        }

        function closeModal() { document.getElementById('bookingModal').style.display = 'none'; }

        async function confirmBooking() {
            const name = document.getElementById('nameInput').value;
            const email = document.getElementById('emailInput').value;
            const phone = document.getElementById('phoneInput').value;
            const date = document.getElementById('dateInput').value;
            
            if(!name || !email || !phone || !date) return alert("Tout est obligatoire !");
            if(phone.length !== 9 || phone.startsWith('0')) return alert("Num√©ro invalide ! 9 chiffres sans le 0.");

            const cleanPhone = "+32" + phone;
            const btn = document.querySelector('.btn-confirm');
            btn.innerText = "Connexion Stripe...";
            btn.disabled = true;

            try {
                const res = await fetch(API_URL + '/create-checkout-session', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        client_name: name, 
                        email: email, 
                        phone: cleanPhone, 
                        service_type: selectedService, 
                        date: date, 
                        price: currentPrice,
                        payment_choice: paymentChoice 
                    })
                });
                const data = await res.json();
                if(data.url) window.location.href = data.url;
                else { alert("Erreur: " + (data.error || "Stripe")); btn.disabled=false; }
            } catch (e) { alert("Erreur serveur"); btn.disabled=false; }
        }

        const badWords = ["merde", "con", "salope", "pute", "connard"];

        async function submitReview() {
            const n = document.getElementById('reviewName').value;
            const c = document.getElementById('reviewContent').value;
            const r = document.getElementById('reviewRating').value;
            
            for(let w of badWords) if(c.toLowerCase().includes(w)) return alert("Contenu inappropri√© d√©tect√©.");
            if(!n || !c) return alert("Veuillez remplir tous les champs.");

            try {
                const res = await fetch(API_URL+'/reviews', {
                    method:'POST', 
                    headers:{'Content-Type':'application/json'}, 
                    body:JSON.stringify({author:n, content:c, rating:r})
                });
                const data = await res.json();
                
                if(data.success && data.token) {
                    // SAUVEGARDE DU TOKEN DANS LE NAVIGATEUR (IMPORTANT POUR POUVOIR SUPPRIMER)
                    localStorage.setItem('lastReviewToken', data.token);
                    alert("Avis publi√© ! Merci.");
                    location.reload();
                }
            } catch(e) { alert("Erreur connexion"); }
        }

        // CHARGEMENT DES AVIS
        fetch(API_URL+'/reviews').then(r=>r.json()).then(reviews => {
            const container = document.getElementById('reviews-display');
            const myToken = localStorage.getItem('lastReviewToken'); // Le token de l'utilisateur actuel

            container.innerHTML = reviews.map(r => {
                // Si l'utilisateur a le token qui correspond √† cet avis (c'est le sien)
                const isMine = (myToken && r.client_token === myToken);
                
                let deleteBtn = '';
                if(isMine) {
                    deleteBtn = `<button onclick="deleteMyReview(${r.id}, '${r.client_token}')" style="background:none; border:none; color:#ff3b30; font-size:12px; cursor:pointer; float:right;">üóëÔ∏è Supprimer mon avis</button>`;
                }

                return `
                <div class="review-item">
                    ${deleteBtn}
                    <b>${r.author}</b> ${'‚≠ê'.repeat(r.rating)}
                    <p>${r.content}</p>
                </div>`;
            }).join('');
        });

        // FONCTION POUR SUPPRIMER SON PROPRE AVIS
        async function deleteMyReview(id, token) {
            if(!confirm("Supprimer votre avis ?")) return;
            const res = await fetch(API_URL + '/reviews/' + id, {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ token: token }) // On envoie le token pour prouver qu'on est l'auteur
            });
            if(res.ok) location.reload();
            else alert("Impossible de supprimer (Token expir√© ou invalide)");
        }

        // TRACKING
        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('src') || document.referrer || 'direct';
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent) ? 'Mobile' : 'PC';

        fetch(API_URL + '/api/track', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ type: 'view', page: 'home', source: source, device: isMobile, target: null })
        });

        function trackClick(targetName) {
            fetch(API_URL + '/api/track', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ type: 'click', page: 'home', source: source, device: isMobile, target: targetName })
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('contactBtn').addEventListener('click', () => trackClick('contact_header'));
            document.body.addEventListener('click', (e) => {
                if(e.target.classList.contains('btn-buy')) {
                    trackClick('bouton_reserver_produit');
                }
            });
        });
    </script>

    <footer style="text-align:center; padding:30px; color:#999; font-size:12px; border-top:1px solid #eee;">
        ¬© 2025 Repair Phone BX ‚Ä¢ <a href="#" onclick="document.getElementById('legalModal').style.display='flex';return false;" style="color:#999">Mentions L√©gales & CGV</a>
        <br><br>
        <a href="/admin-secret-dashboard" style="color: #eee; text-decoration: none;">Admin</a>
    </footer>

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Repair Phone BX",
      "image": "https://repair-phone-bx-1.onrender.com/images/iphone-13.jpg",
      "telephone": "0467791737",
      "email": "aliouking.14@gmail.com",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "Quartier Ribaucourt",
        "addressLocality": "Molenbeek-Saint-Jean",
        "postalCode": "1080",
        "addressCountry": "BE"
      },
      "priceRange": "‚Ç¨‚Ç¨",
      "openingHoursSpecification": [
        {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
          "opens": "10:00",
          "closes": "19:00"
        }
      ]
    }
    </script>
</body>
</html>